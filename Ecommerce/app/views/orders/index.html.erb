<%=javascript_include_tag('manager/product.js') %>
<section>
<div class="container">
  <div class="row">
    <div class="col-sm-3">
      <div class="left-sidebar">
      <%= render 'orders/left' %>
      </div>
    </div>
    
    <div class="col-sm-9 padding-right">
    <label for="start">Search Month:</label>
    <input type="month" id="start" name="start" min="2018-03" value="2021-10">
    <button id="submit" style="color: #fff;
    background-color: #fe980f;" class="btn"> <span> <i class="fa fa-search"></i></span></button>
    
    <section id="cart_items">
		<div class="">
			<div class="table-responsive cart_info">
      <% if @results[:carts_order].size > 0 %>
      <table class="table table-condensed">
					<thead>
						<tr class="cart_menu">
							<td class="image">Image</td>
							<td class="description ">Name</td>
              <td class="description">Size</td>
              <td class="description quantity">Quantity</td>
              <td class="description">Price</td>
							<td class="description">Total Price</td>
							<td class="description">Status</td>
							<td class="description">Buy date</td>
							<td>Action</td>
						</tr>
					</thead>
          <% else %>
           <h2 style="text-align: center"> You have not ordered products yet <h2>
      <% end %>
			
					<tbody class="tbody">
          <% @results[:carts_order].each do |order| %>
            <% order[:product_order].each do |c| %>
              <tr>
                <td class="cart_product">
                  <a href="/product-details/<%= c["name_product"] %>~<%=c["id"] %>"> <%= image_tag c["image_product"], size: "110x110", alt: "Image" %></a>
                </td>
                <td class="cart_description">
                  <h4><a href=""><%= c["name_product"] %></a></h4>
                  <p>Orders ID: <%= order[:order].id %></p>
                </td>
                <td class="cart_description">
                  <p><%= c["size_product"] %></p>
                </td>
                <td class="cart_description">
                  <p><%= c["quantity"] %></p>
                </td>
                 <td class="cart_description">
                  <p><%= c["price_product"] %></p>
                </td>
                <td class="cart_description">
                  <p class="cart_total_price">$<%= c["total"] %></p>
                </td>
                <td class="cart_description">
                  <% case order[:order].status %>
                  <% when 0 %>
                    <p class="">Pending</p>
                    <% when 1 %>
                    <p class="">Confirm</p>
                    <% when 2 %>
                    <p class="">Cancel</p>
                  <% end %>
                </td>
                <td class="cart_description">
                  <p><%= order[:order].created_at.strftime("%d/%m/%Y") %></p>
                </td>
                <% if order[:order].status != 1 %>
                      <td><button class="submit_delete btn btn-danger"  product_id="<%= c["id"] %>" order_id="<%= order[:order].id %>"  > X </button> </td>
                <% end %>
              </tr>
               
              <% end %>
               <td > 
                  <div class=""> <span class="font-weight-bold">Total_Order: </span> <span>$<%= @Total_order = order[:product_order].map{|order| order["price_product"].to_f * order["quantity"].to_i}.sum  %></span> </div>
                    <div class=""> <span class="font-weight-bold">Fee Shipping: </span> <small> + $<%= order[:order].fee %></small> </div>
                     <div class=""> <span class="font-weight-bold">Service: </span> <%= order[:order].service %> </div>
                    <div class=""> <span class="font-weight-bold">Voucher: </span> <small> - $<%= order[:order]&.voucher ? order[:order].voucher : 0 %></small> </div>
                    
                    <span>------------------------------------ <span>
                    <% if order[:order]&.voucher  %>
                        <div class="mt-3"> <span class="font-weight-bold"></span> <span class="btn btn-primary font-weight-bold theme-color">Payment:$<%= @Total_order - order[:order].voucher  + order[:order].fee%></span> </div>
                      <% else %>
                        <div class="mt-3"> <span class="font-weight-bold"></span> <span class="btn btn-primary font-weight-bold theme-color">Payment: $<%= @Total_order.to_f + order[:order].fee %></span> </div>
                    <% end %>
                </td>
          <% end %>
      
					</tbody>
             
				</table>
         <span style="display: none; background-color: #fe800f;" class="btn btn-primary font-weight-bold theme-color total_order_of_month" >  30<span>
          <%= paginate @results[:orders] %>

			</div>
		</div>  
    </div>
  </div>
</div>
</section>
<script id="list-product-template" type="text/x-handlebars-template">
  {{#if carts_order.length }}
    {{#each carts_order}}
      <tr>
        <td class="cart_product">
          <a href=""> <img src={{image_product}} width="110" height="110"> </a>
        </td>
        <td class="cart_description">
          <p><a href="">{{name_product}}</a></p>
        </td>
        <td class="cart_description">
         <p>{{size_product}}</p>
        </td>
        <td class="cart_description">
         <p>{{quantity}}</p>
        </td>
          <td class="cart_description">
         <p>{{price_product}}</p>
        </td>
        <td class="cart_description">
          <p class="cart_total_price">${{total}}</p>
        </td>
        <td class="cart_description">
            <p class="">Confirm</p>
        </td>
      </tr>
  {{/each}}
  <style type="text/css">
    .product_month{
        display:none
    }
  </style>
  {{else}}
    <style type="text/css">
    thead{
        display:none
    }
  </style>
      <h2 style=" text-align: center;"> You don't have product of this month </h2>
  {{/if}}

</script>
<style>
.btn.btn-primary {
    background: #e81818;
    border: 0 none;
    border-radius: 0;
    font-weight: 700;
    margin-top: 16px;
}
</style>